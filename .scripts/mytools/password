#!/bin/bash

. "${HOME}/.cache/wal/colors.sh"
new="generate new password"
chosen=$(printf "$(gopass ls -f)\n$new" | dmenu -nb "$color0" -nf "$color15" -sb "$color1" -sf "$color15" -i -l 10 -p "Which password?" | awk '{print $1}')
[ -z $chosen ] && exit
if [ "$chosen" == "generate" ]; then
    folder=$(printf "$(gopass ls --fo)" | dmenu -nb "$color0" -nf "$color15" -sb "$color1" -sf "$color15" -i -l 10 -p "Which folder?" | awk '{print $1}')
    [ -z $folder ] && exit
    name=$(</dev/null dmenu -nb "$color0" -nf "$color15" -sb "$color1" -sf "$color15" -i -p "Which name?" | awk '{print $1}')
    [ -z $name ] && exit
    gopass --yes generate -s $folder/$name 24 && notify-send "New password copied to clipboard."
    exit
fi
gopass show $chosen | xclip -selection c
notify-send "Secret copied to clipboard.
Will clear in 6 seconds."
sleep 6
echo "" | xclip -selection c
notify-send "Clipboard cleared!"
