#!/bin/sh

pgrep -a openvpn | grep telearbeit && sudo killall openvpn && notify-send "VPN disconnected" && pkill -RTMIN+16 i3blocks && exit

password_file=$XDG_DATA_HOME/openvpn/password
touch $password_file
echo lin > $password_file
gopass show ol/general/sipgate/ldap/lin >> $password_file

sudo openvpn --config $XDG_DATA_HOME/openvpn/telearbeit --auth-user-pass $password_file --daemon &&
    notify-send "successfully connected to VPN" ||
    notify-send -u critical "connection to VPN failed!"

rm $password_file

pkill -RTMIN+16 i3blocks
