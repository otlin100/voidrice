#!/usr/bin/env sh

sounds="$XDG_DATA_HOME/sounds"

toggle() {
    pkill -f "mpv .*anoise" >/dev/null 2>&1 || nohup mpv --loop-file=inf "$sounds"/anoise >/dev/null 2>&1 &
}

case "$1" in
    toggle)
        toggle ;;
    shuffle)
        pkill -f "mpv .*anoise" >/dev/null 2>&1
        success=$?
        newfile=$(find "$sounds"/* -prune -name '*.*' | shuf -n1)
        echo $newfile | xargs -I '{}' cp {} "$sounds"/anoise
        pgrep -x dunst >/dev/null && notify-send "background audio switched to $(basename $newfile)"
        if [ $success -eq 0 ]; then
            nohup mpv --loop-file=inf "$sounds"/anoise >/dev/null 2>&1 &
        fi ;;
esac

pkill -RTMIN+13 i3blocks
