#!/bin/sh

sounds="$XDG_DATA_HOME/sounds"
icon="🐦"

[ -f "$sounds/less_volume" ] && volume=50 || volume=100

play() {
    exec mpv --volume="$volume" --loop-file=inf "$sounds"/anoise >/dev/null 2>&1 &
}

case "$1" in
    toggle)
        pkill -f "mpv .*anoise" >/dev/null 2>&1 || { notify-send "$icon $(cat "$sounds"/track)" && play; } ;;
    shuffle)
        [ "$(pgrep -c -f "anoise shuffle")" -gt 1 ] && exit

        newfile=$(find "$sounds"/* -prune -name '*.*' | shuf -n1)
        cp "$newfile" "$sounds"/anoise

        filename=$(basename "$newfile" | cut -d'.' -f1 | tee "$sounds"/track )
        notify-send "$icon $filename"

        pkill -f "mpv .*anoise" >/dev/null 2>&1 && play ;;
    volume)
        [ -f "$sounds/less_volume" ] && rm "$sounds/less_volume" || touch "$sounds/less_volume"
        anoise restart ;;
    restart)
        pkill -f "mpv .*anoise" >/dev/null 2>&1 && play ;;
esac

pkill -RTMIN+13 dwmblocks
