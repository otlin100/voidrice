#!/bin/bash

pgrep cupsd >/dev/null || sudo cupsd
tmpdir=scan-$RANDOM
startdir=$(pwd)
printer=hpaio:/net/OfficeJet_3830_series?zc=HP80CE62B57980
# printer=hpaio:/usb/Deskjet_F2400_series?serial=CN9AE171XZ05BS

cd /tmp || exit
mkdir "$tmpdir"
cd "$tmpdir" || exit

outname="$1".pdf
contrast=0
brightness=2000
resolution=300

notify-send "### Scanning ###"
hp-scan -o "$outname" -c $contrast -b $brightness -m grey -r $resolution -d "$printer" --size=a4 --compression=raw --adf ||
hp-scan -o "$outname" -c $contrast -b $brightness -r $resolution -d "$printer" --size=a4 --compression=raw ||
{ notify-send -t 15000 -u critical "failed to scan"; exit; }

notify-send "### Compressing ###"
pdfcompress "$outname"
mv compressed_"$outname" "$HOME"/Downloads/"$outname"

notify-send "### Cleaning Up ###"
rm -rf "$tmpdir"
cd "$startdir" || exit
