#!/usr/bin/env bash

tmpdir=scan-$RANDOM
startdir=$(pwd)

cd /tmp || exit
mkdir "$tmpdir"
cd "$tmpdir" || exit

outname="$1".pdf

echo "################ Scanning ################"
hp-scan -o "$outname" --adf -c 1500 -b 1600 -m grey -r 300 -d hpaio:/net/OfficeJet_3830_series?zc=HP80CE62B57980 --size=a4 --compression=none
wait

[ $? -eq 1 ] && pgrep -x dunst >/dev/null && notify-send -t 15000 -u critical "failed to scan" && exit

echo "################ Compressing ################"
pdfcompress "$outname"
mv compressed_"$outname" "$HOME"/Downloads/"$outname"

echo "################ Cleaning Up ################"
rm -rf "$tmpdir"
cd "$startdir" || exit
